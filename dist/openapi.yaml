openapi: 3.0.0
info:
  title: Boys State App API
  description: |
    **Disclaimer:** This project is being developed to support Boys State & Girls State programs affiliated with the American Legion, but is not created, funded, or officially supported by the American Legion. No endorsement or sponsorship is implied. All branding, configuration, and operational decisions are made independently by the appâ€™s creators and participating programs.
    
    The API provides authentication endpoints and health checks used by the Boys State App mobile and web clients. The following documentation describes the requests and responses in detail.
  version: 1.0.0
servers:
  - url: https://boysstateappservices.up.railway.app

tags:
  - name: system
    description: Endpoints for service monitoring and status
  - name: auth
    description: User registration and login
  - name: groupingTypes
    description: Manage grouping type definitions
  - name: groupings
    description: Manage program groupings

paths:
  /health:
    get:
      tags: [system]
      summary: Service and database status
      description: >
        Returns a simple JSON object indicating that the service is running and
        whether the database connection is healthy.
      responses:
        '200':
          description: Successful health response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Overall service status
                    example: ok
                  database:
                    type: string
                    description: Database connection status
                    example: ok
      security:
        - bearerAuth: []
  /register:
    post:
      tags: [auth]
      summary: Register a new user
      description: >
        Creates a new user account using an email and password. The email must be
        unique. A successful request returns a confirmation message.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: user@example.com
                password:
                  type: string
                  description: Plain text password to register
                  example: mySecret
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User created
        '400':
          description: Email already exists or invalid input
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: User already exists
  /login:
    post:
      tags: [auth]
      summary: Authenticate an existing user
      description: >
        Checks the provided email and password and returns a success message when
        the credentials are valid.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: Registered email address
                  example: user@example.com
                password:
                  type: string
                  description: Account password
                  example: mySecret
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT authentication token containing user id and email (expires after 30 minutes)
                    example: >-
                      eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImlhdCI6MT
                      Y4NTg0OTc1NX0.LXrlo3wrX7rQiGZnYuxRKgXUxRvQPgFP5yxv1rdqe8E
        '400':
          description: Missing credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Email and password required
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid credentials
        '429':
          description: Too many failed login attempts
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Too many login attempts

  /logs:
    post:
      tags: [system]
      summary: Submit a log message
      description: >
        Allows authenticated clients to send a log entry associated with a
        program. The server stores the entry for auditing and troubleshooting.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [programId, level, message]
              properties:
                programId:
                  type: string
                  description: Program identifier for the log entry
                  example: abc123
                level:
                  type: string
                  description: Log level
                  enum: [debug, info, warn, error]
                  example: info
                message:
                  type: string
                  description: Log message text
                  example: Something happened
                error:
                  type: string
                  description: Optional error details for error logs
                  example: Stack trace
                source:
                  type: string
                  description: Where the log originated (api or client)
                  example: client
      responses:
        '204':
          description: Log recorded
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: programId, level, and message required
      security:
        - bearerAuth: []
    get:
      tags: [system]
      summary: Retrieve log messages
      description: >
        Returns logs filtered by program, level, source, date range, and search query.
        Results are sorted by newest first and paginated.
      parameters:
        - in: query
          name: programId
          schema:
            type: string
          description: Filter logs by program ID
        - in: query
          name: level
          schema:
            type: string
            enum: [debug, info, warn, error]
          description: Log level to filter
        - in: query
          name: source
          schema:
            type: string
          description: Log source (client or api)
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date-time
          description: Include logs from this date/time (inclusive)
        - in: query
          name: dateTo
          schema:
            type: string
            format: date-time
          description: Include logs up to this date/time (inclusive)
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search in message, error, or source
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
            maximum: 100
          description: Number of records per page
      responses:
        '200':
          description: List of logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        timestamp:
                          type: string
                          format: date-time
                          example: '2025-06-01T10:20:30Z'
                        programId:
                          type: string
                          example: abc123
                        level:
                          type: string
                          enum: [debug, info, warn, error]
                        message:
                          type: string
                          example: Database crashed
                        error:
                          type: string
                          example: Stack trace here
                        source:
                          type: string
                          example: api
                  page:
                    type: integer
                    example: 1
                  pageSize:
                    type: integer
                    example: 50
                  total:
                    type: integer
                    example: 244
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid level
      security:
        - bearerAuth: []
  /programs:
    get:
      tags: [programs]
      summary: List all programs
      responses:
        '200':
          description: Array of programs
      security:
        - bearerAuth: []
    post:
      tags: [programs]
      summary: Create a new program
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, year]
              properties:
                name:
                  type: string
                  example: Texas Boys State 2025
                year:
                  type: integer
                  example: 2025
                config:
                  type: object
                  description: Optional program configuration
      responses:
        '201':
          description: Program created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  year:
                    type: integer
                  createdBy:
                    type: integer
                  roleAssigned:
                    type: string
                    example: admin
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
      example: name and year required
      security:
        - bearerAuth: []
  /programs/{id}:
    get:
      tags: [programs]
      summary: Get program details
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Program object
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
    put:
      tags: [programs]
      summary: Update program
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                year:
                  type: integer
                config:
                  type: object
                status:
                  type: string
      responses:
        '200':
          description: Updated program
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
    delete:
      tags: [programs]
      summary: Retire program
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Program retired
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
  /programs/{programId}/users:
    post:
      tags: [programs]
      summary: Assign user to program
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, role]
              properties:
                userId:
                  type: integer
                role:
                  type: string
                  example: counselor
      responses:
        '201':
          description: User assigned
          content:
            application/json:
              schema:
                type: object
                properties:
                  programId:
                    type: string
                  userId:
                    type: integer
                  role:
                    type: string
                  status:
                    type: string
                    example: assigned
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
    get:
      tags: [programs]
      summary: List users in program
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      responses:
        '200':
          description: Array of users and roles
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    userId:
                      type: integer
                    role:
                      type: string
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
  /programs/{programId}/years:
    post:
      tags: [programs]
      summary: Create program year
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [year]
              properties:
                year:
                  type: integer
                  example: 2025
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
                status:
                  type: string
                notes:
                  type: string
      responses:
        '201':
          description: Created program year
        '400':
          description: Invalid input
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
    get:
      tags: [programs]
      summary: List program years
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      responses:
        '200':
          description: Array of program years
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
  /programs/{programId}/grouping-types:
    post:
      tags: [groupingTypes]
      summary: Add grouping type
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [defaultName, levelOrder]
              properties:
                defaultName:
                  type: string
                customName:
                  type: string
                pluralName:
                  type: string
                levelOrder:
                  type: integer
                isRequired:
                  type: boolean
      responses:
        '201':
          description: Created grouping type
        '400':
          description: Invalid input
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
    get:
      tags: [groupingTypes]
      summary: List grouping types
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      responses:
        '200':
          description: Array of grouping types
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
  /grouping-types/{id}:
    put:
      tags: [groupingTypes]
      summary: Update grouping type
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                customName:
                  type: string
                pluralName:
                  type: string
                levelOrder:
                  type: integer
                isRequired:
                  type: boolean
                status:
                  type: string
      responses:
        '200':
          description: Updated grouping type
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
    delete:
      tags: [groupingTypes]
      summary: Retire grouping type
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Retired grouping type
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
  /programs/{programId}/groupings:
    post:
      tags: [groupings]
      summary: Add grouping
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [groupingTypeId, name]
              properties:
                groupingTypeId:
                  type: integer
                parentGroupingId:
                  type: integer
                name:
                  type: string
                displayOrder:
                  type: integer
                notes:
                  type: string
      responses:
        '201':
          description: Created grouping
        '400':
          description: Invalid input
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
    get:
      tags: [groupings]
      summary: List groupings
      parameters:
        - in: path
          name: programId
          required: true
          schema:
            type: string
          description: Program ID
      responses:
        '200':
          description: Array of groupings
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
  /groupings/{id}:
    put:
      tags: [groupings]
      summary: Update grouping
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                displayOrder:
                  type: integer
                notes:
                  type: string
                parentGroupingId:
                  type: integer
                status:
                  type: string
      responses:
        '200':
          description: Updated grouping
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
    delete:
      tags: [groupings]
      summary: Retire grouping
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Retired grouping
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
  /program-years/{id}/groupings/activate:
    post:
      tags: [groupings]
      summary: Activate groupings for year
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Program Year ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [groupingIds]
              properties:
                groupingIds:
                  type: array
                  items:
                    type: integer
      responses:
        '201':
          description: Activated groupings
        '403':
          description: Forbidden
        '404':
          description: Not found
        '400':
          description: Invalid input
      security:
        - bearerAuth: []
  /program-years/{id}/groupings:
    get:
      tags: [groupings]
      summary: List active groupings for year
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Program Year ID
      responses:
        '200':
          description: Array of active groupings
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
  /program-years/{id}:
    get:
      tags: [programs]
      summary: Get program year
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Program year
        '404':
          description: Not found
        '403':
          description: Forbidden
      security:
        - bearerAuth: []
    put:
      tags: [programs]
      summary: Update program year
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
                status:
                  type: string
                notes:
                  type: string
      responses:
        '200':
          description: Updated program year
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
    delete:
      tags: [programs]
      summary: Archive program year
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Archived program year
        '403':
          description: Forbidden
        '404':
          description: Not found
      security:
        - bearerAuth: []
  /user-programs/{username}:
    get:
      tags: [programs]
      summary: List programs for a user
      description: >
        Returns all programs assigned to the specified user. Each item
        includes the program id, name, and role.
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
          description: Email or username of the user
      responses:
        '200':
          description: List of programs
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                    description: User email or username
                    example: jane.doe
                  programs:
                    type: array
                    items:
                      type: object
                      properties:
                        programId:
                          type: string
                          example: abc123
                        programName:
                          type: string
                          example: Boys State Texas
                        role:
                          type: string
                          example: admin
        '400':
          description: Username required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Username required
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: User not found
      security:
        - bearerAuth: []
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
